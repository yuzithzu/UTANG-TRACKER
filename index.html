<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Utang Tracker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        background-color: #f8f9fa;
    }
    h2, h3 {
        text-align: center;
        color: #343a40;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
        font-size: 12px;
    }
    th {
        background-color: #6c757d;
        color: white;
    }
    .filter {
        width: calc(100% - 20px);
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        -webkit-user-select: none;
        touch-action: manipulation;
    }
    .filter:focus {
        border-color: dodgerblue;
        outline: none;
    }
    #summary, #utangListDiv, #paymentHistory {
        margin: 20px 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .scrollable-table {
        max-height: 150px;
        overflow: auto;
    }
    .scrollable-table table {
        border-collapse: collapse;
        width: 100%;
        display: table;
    }
    form {
        margin: 20px 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
        color: #495057;
    }
    input[type="text"], input[type="number"], input[type="date"] {
        width: calc(100% - 22px);
        padding: 8px;
        margin-top: 5px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        -webkit-user-select: none;
        touch-action: manipulation;
    }
    input:focus {
        border-color: dodgerblue;
        outline: none;
    }
    button {
        display: inline-block;
        padding: 10px 20px;
        margin-top: 10px;
        margin-right: 5px;
        border: none;
        background-color: dodgerblue;
        color: white;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover {
        background-color: deepskyblue;
    }
    @media (min-width: 768px) {
        .container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .container > div, form {
            flex: 1 1 calc(50% - 20px);
            margin: 10px;
        }
    }
    @media (max-width: 768px) {
        .container {
            display: block;
        }
    }
    .blue-row {
        background-color: #cce5ff;
        color: black;
    }
    .highlight-row {
        background-color: #e6f7ff;
    }
    .balance-cell {
        background-color: #ffc107;
        font-weight: bold;
    }
    .summary-table th {
        background-color: #007bff;
        color: white;
    }
    .summary-table td {
        background-color: #e9ecef;
    }
</style>
</head>
<body>

<h2>Utang Tracker</h2>

<div class="container">
    <form id="utangForm">
        <label for="name">Name ng Umutang:</label>
        <input type="text" id="name" name="name">
        <label for="initialLoan">Initial Loan:</label>
        <input type="number" id="initialLoan" name="initialLoan" step="0.01">
        <label for="loanDate">Loan Date:</label>
        <input type="date" id="loanDate" name="loanDate">
        <button type="button" onclick="addUtang()">Enter</button>
    </form>

    <div id="summary">
        <h3>Summary</h3>
        <input type="date" id="filterDate" class="filter" placeholder="Filter by date" onchange="updateSummary()">
        <button onclick="clearSummary()">Clear Filter</button>
        <button onclick="resetAllRecords()">Reset All Records</button>
        <div class="scrollable-table">
            <table id="summaryTable" class="summary-table">
                <thead>
                    <tr>
                        <th>Total Investment</th>
                        <th>Total Interest</th>
                        <th>Daily Payment</th>
                        <th>Total Balance</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="summaryBody"></tbody>
            </table>
        </div>
    </div>

    <div id="utangListDiv">
        <h3>Utang List</h3>
        <input type="text" id="filterUtang" class="filter" placeholder="Filter by name" onkeyup="filterTable('utangList', this.value)">
        <div class="scrollable-table">
            <table id="utangList">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Loan Date</th>
                        <th>Initial Loan</th>
                        <th>Interest (20%)</th>
                        <th>Total Loan</th>
                        <th>Payment</th>
                        <th>Date</th>
                        <th>Balance</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="paymentHistory">
        <h3>Payment History</h3>
        <input type="text" id="filterPaymentHistory" class="filter" placeholder="Filter by name" onkeyup="filterTable('paymentHistoryTable', this.value)">
        <div class="scrollable-table">
            <table id="paymentHistoryTable">
                <thead>
                    <tr>
                        <th>Name ng Umutang</th>
                        <th>Amount Paid</th>
                        <th>Date Paid</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="paymentHistoryBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    var utangList = JSON.parse(localStorage.getItem("utangList")) || [];
    var paymentHistory = JSON.parse(localStorage.getItem("paymentHistory")) || [];

    function saveData() {
        localStorage.setItem("utangList", JSON.stringify(utangList));
        localStorage.setItem("paymentHistory", JSON.stringify(paymentHistory));
    }

    function formatCurrency(number) {
        return number.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' });
    }

    function addUtang() {
        var name = document.getElementById("name").value;
        var initialLoan = parseFloat(document.getElementById("initialLoan").value);
        var loanDate = document.getElementById("loanDate").value;
        if (name === "" || isNaN(initialLoan) || initialLoan <= 0 || loanDate === "") {
            alert("Please enter valid data.");
            return;
        }
        var interest = initialLoan * 0.2;
        var totalLoan = initialLoan + interest;
        var balance = totalLoan;
        var newRow = { name, loanDate, initialLoan, interest, totalLoan, balance, payments: [] };
        utangList.push(newRow);
        saveData();
        renderUtangList();
        updateSummary();
        document.getElementById("name").value = "";
        document.getElementById("initialLoan").value = "";
        document.getElementById("loanDate").value = "";
    }

    function renderUtangList() {
        var tbody = document.getElementById("utangList").getElementsByTagName('tbody')[0];
        tbody.innerHTML = "";
        utangList.forEach((utang, index) => {
            var rowClass = utang.balance === 0 ? 'class="blue-row"' : '';
            var row = `<tr ${rowClass} onclick='highlightRow(this)'>
                <td>${utang.name}</td>
                <td>${utang.loanDate}</td>
                <td>${formatCurrency(utang.initialLoan)}</td>
                <td>${formatCurrency(utang.interest)}</td>
                <td>${formatCurrency(utang.totalLoan)}</td>
                <td><input type='number' class='payment' min='0' step='0.01'></td>
                <td><input type='date' class='date'></td>
                <td class="balance-cell">${formatCurrency(utang.balance)}</td>
                <td><button onclick='submitPayment(${index}, this)'>Submit</button><button onclick='deleteUtang(${index})'>Delete</button></td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    function highlightRow(row) {
        var rows = row.parentElement.getElementsByTagName("tr");
        for (var i = 0; i < rows.length; i++) {
            rows[i].classList.remove('highlight-row');
        }
        row.classList.add('highlight-row');
    }

    function submitPayment(index, button) {
        var row = button.parentElement.parentElement;
        var paymentInput = row.querySelector(".payment");
        var payment = parseFloat(paymentInput.value);
        var date = row.querySelector(".date").value;
        if (isNaN(payment) || payment <= 0 || date === "") {
            alert("Please enter valid payment and date.");
            return;
        }
        if (payment > utangList[index].balance) {
            alert("Payment exceeds balance.");
            return;
        }
        utangList[index].balance -= payment;
        utangList[index].payments.push({ amount: payment, date });
        paymentHistory.push({ name: utangList[index].name, amount: payment, date });
        saveData();
        renderUtangList();
        renderPaymentHistory();
        updateSummary();
    }

    function deleteUtang(index) {
        if (confirm("Are you sure you want to delete this utang?")) {
            utangList.splice(index, 1);
            saveData();
            renderUtangList();
            updateSummary();
        }
    }

    function renderPaymentHistory() {
        var tbody = document.getElementById("paymentHistoryBody");
        tbody.innerHTML = "";
        paymentHistory.forEach((payment, index) => {
            var row = `<tr>
                <td>${payment.name}</td>
                <td>${formatCurrency(payment.amount)}</td>
                <td>${payment.date}</td>
                <td><button onclick='deletePayment(${index})'>Delete</button></td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    function deletePayment(index) {
        if (confirm("Are you sure you want to delete this payment?")) {
            var payment = paymentHistory[index];
            var utang = utangList.find(utang => utang.name === payment.name);
            if (utang) {
                utang.balance += payment.amount;
                utang.payments = utang.payments.filter(p => !(p.amount === payment.amount && p.date === payment.date));
            }
            paymentHistory.splice(index, 1);
            saveData();
            renderPaymentHistory();
            renderUtangList();
            updateSummary();
        }
    }

    function updateSummary() {
        var totalInvestment = utangList.reduce((sum, utang) => sum + utang.initialLoan, 0);
        var totalInterest = utangList.reduce((sum, utang) => sum + utang.interest, 0);
        var filterDate = document.getElementById("filterDate").value;
        var totalPayment = 0;
        var totalBalance = 0;

        paymentHistory.forEach(payment => {
            if (!filterDate || payment.date === filterDate) {
                totalPayment += payment.amount;
            }
        });

        utangList.forEach(utang => {
            totalBalance += utang.balance;
        });

        var summaryRow = `<tr>
            <td>${formatCurrency(totalInvestment)}</td>
            <td>${formatCurrency(totalInterest)}</td>
            <td>${formatCurrency(totalPayment)}</td>
            <td>${formatCurrency(totalBalance)}</td>
            <td>${filterDate || "All Dates"}</td>
        </tr>`;
        document.getElementById("summaryBody").innerHTML = summaryRow;
    }

    function filterTable(tableId, filterValue) {
        var table, tr, td, i, txtValue;
        table = document.getElementById(tableId);
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none";
            td = tr[i].getElementsByTagName("td");
            for (var j = 0; j < td.length; j++) {
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toLowerCase().indexOf(filterValue.toLowerCase()) > -1) {
                        tr[i].style.display = "";
                        break;
                    }
                }
            }
        }
    }

    function clearSummary() {
        document.getElementById("filterDate").value = "";
        updateSummary();
    }

    function resetAllRecords() {
        if (confirm("Are you sure you want to reset all records? This action cannot be undone.")) {
            localStorage.clear();
            utangList = [];
            paymentHistory = [];
            renderUtangList();
            renderPaymentHistory();
            updateSummary();
        }
    }

    window.onload = function() {
        renderUtangList();
        renderPaymentHistory();
        updateSummary();
    }
</script>

</body>
</html>
